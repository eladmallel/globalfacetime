{% extends 'base.html' %}
{% block scripts %}

<script type="text/javascript">
  profile_id = {{profile_id}}
</script>

<script src="https://static.vline.com/vline.js"></script>
<script src="/static/js/video-page.js"></script>

<script>
     logoNames = [
        "ChatSummit",
        "AnyUni",
        "ChatGo",
        "Bridg.er",
        "HubSphere",
        "ChatMountain",
        "Club 84",
     ]

     function nextChat() {
        $(".current-video").addClass('searching-for-partner');
        window.chatWindow.disconnect();

        window.setTimeout(function() {
            window.chatWindow.connect();
        },5000);
     }

     $(function() {
        $(".current-video").addClass('searching-for-partner'); /* Show the searching icon before we start */

        console.log("Logging in...");
        $.ajax({
         method: "GET",
         dataType: "JSON",
         url: "/login",
         data: {
            user:GlobalFaceTime.user
          },
          success: function(data) {
            GlobalFaceTime.chatClient = new ChatClient(data.token,function() {
                window.chatWindow = new ChatWindow(GlobalFaceTime.user,GlobalFaceTime.chatClient,"#myPublisherDivContainer","#mySubscriberDivContainer");

                nextChat();
            },function() {
                $(".current-video").removeClass('searching-for-partner');
            },function() {
                nextChat();
            })
          }
        });

        $("#next-button").click(function() {
           window.chatWindow.disconnect();
        });

        var chosenLogo = logoNames[Math.floor(Math.random() * logoNames.length)];   
        $("#logo-text").text(chosenLogo);
     });
     </script>

     <link href="/static/css/style-video.css" rel="stylesheet" type="text/css">
{% endblock %}
{% block content %}
<div class="videos-section clearfix">
    <div class="current-video">
        <div class="video-frame video-main">
            <div class='spinner-container'>
              <div class='vertical-align-hack'></div>
              <img class="loading-spinner spinner" src="/static/images/big_loader.gif">
              <img class="loading-spinner search" src="/static/images/search.png">
            </div>
            <div id="mySubscriberDivContainer"></div>

            <div class="video-frame video-secondary">
                <div class='spinner-container'>
                  <div class='vertical-align-hack'></div>
                  <img class="loading-spinner" src="/static/images/big_loader.gif">
                </div>
                <div id="myPublisherDivContainer"></div>
            </div>
        </div>
    </div>

    <div class="next-video">
        <div class="video-frame video-next">
        </div>
    </div>
</div>

<div class="chat-information">
    <div class="connect-section">
      <div class="partner-profile-picture"></div>
      <div class="connect-button"><div class='connect-plus'></div>connect</div>  
    </div>
    <div class="next-button" id="next-button"><div class='next-arrows'></div><div class='next-text'>NEXT</div></div>
    <div class="partner-information">
        <h4 class="partner-name">Jonathan Libov</h4>
        <p class="partner-description">Loves bagels, sunny days, walks on the beach, antipasti salads, coffee squats, and spaceship computers.</p>
    </div>
</div>
{% endblock %}